<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>شات الأرقام 2008</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<style>
    body { font-family: Tahoma, Arial, sans-serif; background: #fff; margin: 10px; direction: rtl; }
    .header-container { display: flex; justify-content: space-between; align-items: center; background: #f5f5f5; padding: 10px; border-bottom: 1px solid #000; margin-bottom: 15px; }
    .room-title { font-weight: bold; font-size: 15px; flex: 1; text-align: center; }
    .nav-links { text-align: left; font-size: 11px; flex: 1; line-height: 1.5; }
    .nav-links a { color: #0066cc; text-decoration: underline; display: block; cursor: pointer; }
    .send-box { display: flex; gap: 5px; margin-bottom: 15px; align-items: center; flex-wrap: wrap; }
    input[type="text"] { width: 60%; border: 1px solid #777; font-size: 13px; padding: 3px; }
    button { font-size: 11px; padding: 2px 6px; background: #e1e1e1; border: 1px solid #888; cursor: pointer; }
    .delete-btn { background: #ffcccc; color: #900; border: 1px solid #900; } /* ستايل زر المسح */
    .chat-box { border-top: 1px solid #000; height: 400px; overflow-y: auto; padding-top: 5px; }
    .message { border-bottom: 1px solid #eee; padding: 5px 0; }
    .nick { color: #0066cc; text-decoration: underline; font-weight: bold; }
    .spacer { flex: 1; }
</style>
</head>
<body>
<div class="header-container">
    <div class="spacer"></div>
    <div class="room-title">العام</div>
    <div class="nav-links">
        <a href="#">[الرومات]</a>
        <a href="#">[الخاص]</a>
        <a href="index.html">[خروج]</a>
    </div>
</div>
<div class="send-box">
    <input type="text" id="messageInput" placeholder="اكتب هنا...">
    <button id="sendBtn">إرسال</button>
    <button onclick="document.getElementById('messageInput').value=''">تحديث</button>
    <button class="delete-btn" onclick="clearChat()">مسح الشات</button>
</div>
<div class="chat-box" id="chatBox"></div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDQb40w_XQE3F9AIJ16OtO9sDt6kIDCw9g",
        authDomain: "myoldchat-40cbe.firebaseapp.com",
        databaseURL: "https://myoldchat-40cbe-default-rtdb.firebaseio.com",
        projectId: "myoldchat-40cbe",
        appId: "1:220431876089:web:d7c20309e3213e47b94728"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let userNick = localStorage.getItem("user_nick");
    if(!userNick) {
        userNick = prompt("أدخل النيك نيم:", "زائر");
        if(!userNick) userNick = "زائر";
        localStorage.setItem("user_nick", userNick);
    }

    function sendMessage() {
        const msgInput = document.getElementById('messageInput');
        if (msgInput.value.trim() !== "") {
            database.ref('messages').push().set({ username: userNick, message: msgInput.value });
            msgInput.value = "";
        }
    }

    // وظيفة مسح الشات
    function clearChat() {
        if (confirm("هل أنت متأكد من مسح جميع الرسائل نهائياً؟")) {
            database.ref('messages').set(null); // يمسح كل الرسائل من Firebase
            document.getElementById('chatBox').innerHTML = ""; // يمسح الرسائل من الشاشة
        }
    }

    document.getElementById('sendBtn').onclick = sendMessage;
    document.getElementById('messageInput').onkeypress = (e) => { if(e.keyCode == 13) sendMessage(); };

    // مراقبة الرسائل الجديدة والمسح
    database.ref('messages').on('value', (snapshot) => {
        const chatBox = document.getElementById('chatBox');
        chatBox.innerHTML = ""; // تصفير الشاشة قبل عرض البيانات (مهم لعملية المسح)
        
        snapshot.forEach((childSnapshot) => {
            const data = childSnapshot.val();
            const msgDiv = document.createElement('div');
            msgDiv.className = 'message';
            msgDiv.innerHTML = `<span class="nick">${data.username}</span>: ${data.message}`;
            chatBox.appendChild(msgDiv);
        });
        chatBox.scrollTop = chatBox.scrollHeight;
    });
</script>
</body>
</html>

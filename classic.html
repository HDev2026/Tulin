<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø´Ø§Øª Ø§Ù„Ø£Ø±Ù‚Ø§Ù… 2010</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<style>
    /* Ù†ÙØ³ Ø£Ù„ÙˆØ§Ù† Ù…Ù„Ù index.html Ø¨Ø§Ù„Ø¶Ø¨Ø· Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙ†Ø§Ø³Ù‚ */
    :root {
        --bg-body: #121212;
        --bg-box: #1e1e1e;
        --text-h1: #00a852; 
        --text-p: #bbb;
        --border-main: #006c35;
        --input-bg: #2d2d2d;
        --input-text: #fff;
        --input-border: #444;
        --msg-border: #2d2d2d;
    }

    [data-theme="light"] {
        --bg-body: #fdfdfd;
        --bg-box: #f5f5f5;
        --text-h1: #0066cc;
        --text-p: #000;
        --border-main: #000;
        --input-bg: #fff;
        --input-text: #000;
        --input-border: #777;
        --msg-border: #eee;
    }

    body { font-family: Tahoma, Arial, sans-serif; background: var(--bg-body); color: var(--text-p); margin: 10px; direction: rtl; transition: 0.3s; }
    
    .header-container { 
        display: flex; justify-content: space-between; align-items: center; 
        background: var(--bg-box); padding: 10px; border-bottom: 1px solid var(--border-main); 
        margin-bottom: 15px; position: relative;
    }
    
    /* Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨Ù†ÙØ³ Ø£Ø³Ù„ÙˆØ¨ index */
    .theme-btn { cursor: pointer; background: none; border: none; font-size: 18px; outline: none; margin-left: 10px; }

    .room-title { font-weight: bold; font-size: 15px; flex: 1; text-align: center; color: var(--text-h1); }
    
    .nav-links { text-align: left; font-size: 11px; flex: 1; line-height: 1.5; }
    .nav-links a, .nav-links span { color: var(--text-h1); text-decoration: underline; display: block; cursor: pointer; }
    
    .send-box { display: flex; gap: 5px; margin-bottom: 15px; align-items: center; }
    
    input[type="text"] { 
        width: 60%; border: 1px solid var(--input-border); 
        background: var(--input-bg); color: var(--input-text); 
        font-size: 13px; padding: 5px; outline: none; 
    }
    
    button { 
        font-size: 11px; padding: 4px 8px; 
        background: var(--input-bg); color: var(--text-p); 
        border: 1px solid var(--input-border); cursor: pointer; 
    }
    
    .chat-box { border-top: 1px solid var(--border-main); height: 400px; overflow-y: auto; padding-top: 5px; }
    
    .message { border-bottom: 1px solid var(--msg-border); padding: 5px 0; }
    
    .nick { color: var(--text-h1); text-decoration: underline; font-weight: bold; }
    
    .spacer { flex: 1; }
</style>
</head>
<body data-theme="dark"> <script>
    // --- Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø³Ø§Ø± ---
    if (sessionStorage.getItem("access_granted") !== "true") {
        alert("ØªÙ†Ø¨ÙŠÙ‡: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ØŒ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ø£ÙˆÙ„Ø§Ù‹.");
        window.location.href = "index.html";
    }
</script>

<div class="header-container">
    <button class="theme-btn" onclick="toggleTheme()">ğŸŒ“</button>
    <div class="nav-links" style="text-align: right;">
        <span onclick="clearChat()">[Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Øª]</span>
    </div>
    <div class="room-title">Ø§Ù„Ø¹Ø§Ù…</div>
    <div class="nav-links">
        <a href="#">[Ø§Ù„Ø±ÙˆÙ…Ø§Øª]</a>
        <a href="#">[Ø§Ù„Ø®Ø§Øµ]</a>
        <a href="index.html">[Ø®Ø±ÙˆØ¬]</a>
    </div>
</div>

<div class="send-box">
    <input type="text" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§...">
    <button id="sendBtn">Ø¥Ø±Ø³Ø§Ù„</button>
    <button onclick="document.getElementById('messageInput').value=''">ØªØ­Ø¯ÙŠØ«</button>
</div>

<div class="chat-box" id="chatBox"></div>

<script>
    // Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹
    function toggleTheme() {
        const body = document.body;
        const currentTheme = body.getAttribute('data-theme');
        body.setAttribute('data-theme', currentTheme === 'light' ? 'dark' : 'light');
    }

    const firebaseConfig = {
        apiKey: "AIzaSyDQb40w_XQE3F9AIJ16OtO9sDt6kIDCw9g",
        authDomain: "myoldchat-40cbe.firebaseapp.com",
        databaseURL: "https://myoldchat-40cbe-default-rtdb.firebaseio.com",
        projectId: "myoldchat-40cbe",
        appId: "1:220431876089:web:d7c20309e3213e47b94728"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let userNick = localStorage.getItem("user_nick");
    if(!userNick) {
        userNick = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†ÙŠÙƒ Ù†ÙŠÙ…:", "Ø²Ø§Ø¦Ø±");
        if(!userNick) userNick = "Ø²Ø§Ø¦Ø±";
        localStorage.setItem("user_nick", userNick);
    }

    function sendMessage() {
        const msgInput = document.getElementById('messageInput');
        if (msgInput.value.trim() !== "") {
            database.ref('messages').push().set({ username: userNick, message: msgInput.value });
            msgInput.value = "";
        }
    }

    function clearChat() {
        if (confirm("Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Ø§Ù„Ø·Ø±ÙÙŠÙ†ØŒ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) {
            database.ref('messages').set(null);
        }
    }

    document.getElementById('sendBtn').onclick = sendMessage;
    document.getElementById('messageInput').onkeypress = (e) => { if(e.keyCode == 13) sendMessage(); };

    database.ref('messages').on('value', (snapshot) => {
        const chatBox = document.getElementById('chatBox');
        chatBox.innerHTML = "";
        snapshot.forEach((childSnapshot) => {
            const data = childSnapshot.val();
            const msgDiv = document.createElement('div');
            msgDiv.className = 'message';
            msgDiv.innerHTML = `<span class="nick">${data.username}</span>: ${data.message}`;
            chatBox.appendChild(msgDiv);
        });
        chatBox.scrollTop = chatBox.scrollHeight;
    });
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>شات الأرقام</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
    /* الستايل الأصلي كما تحبه بدون أي تعديل */
    body { font-family: Tahoma, sans-serif; background-color: #f0f0f0; direction: rtl; }
    .header { background-color: #808080; color: white; padding: 5px; display: flex; justify-content: space-between; }
    .exit-btn { color: white; text-decoration: none; cursor: pointer; }
    #chatBox { border: 1px solid #000; height: 300px; overflow-y: scroll; background-color: white; padding: 5px; margin-top: 10px; }
    .controls { margin-top: 10px; border: 1px solid #808080; padding: 5px; background-color: #d3d3d3; }
    button { cursor: pointer; }
</style>
</head>
<body>

<div class="header">
    <span>[ متصل الآن ]</span>
    <a href="index.html" class="exit-btn">[ خروج X ]</a>
</div>

<div id="chatBox"></div>

<div class="controls">
    <input type="text" id="msgInput" placeholder="اكتب هنا...">
    <button onclick="send()">إرسال</button>
    <br><br>
    <button onclick="console.log('Refresh View')">[ تحديث ]</button>
    <button onclick="alert('شات الأرقام 2008')">[ حول ]</button>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDQb40w_XQE3F9AIJ16OtO9sDt6kIDCw9g",
        authDomain: "myoldchat-40cbe.firebaseapp.com",
        databaseURL: "https://myoldchat-40cbe-default-rtdb.firebaseio.com",
        projectId: "myoldchat-40cbe",
        appId: "1:220431876089:web:d7c20309e3213e47b94728"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // نظام الذاكرة ليبقى الاسم ثابتاً ولا يطلب التحديث
    let nick = localStorage.getItem("user_nick");
    if (!nick) {
        nick = prompt("أدخل النيك نيم:");
        if (nick) localStorage.setItem("user_nick", nick);
        else nick = "زائر";
    }

    function send() {
        const txt = document.getElementById('msgInput');
        if(txt.value.trim() !== "") {
            db.ref('messages').push().set({
                user: nick,
                text: txt.value
            });
            txt.value = "";
        }
    }

    db.ref('messages').limitToLast(20).on('child_added', (snap) => {
        const m = snap.val();
        const box = document.getElementById('chatBox');
        box.innerHTML += `<div><b>[${m.user}]</b>: ${m.text}</div>`;
        box.scrollTop = box.scrollHeight;
    });
</script>

</body>
</html>
